{
  "hash": "c89b72095f3f74b1cbef4089f606bdcb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Annexation Station\"\ndescription: \"Lookout for boundary changes when population totals jump\"\nauthor:\n  - name: Aaron Olson\n    url: https://github.com/marginofaaron\ndate: 12-14-2024\ncategories: [R, census] # self-defined categories\nimage: fig-kokomo-2010-2020-1.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    code-copy: true\nexecute:\n  warning: false\n  message: false\n---\n\n## Introduction\n\nAnalyzing population growth over time is a common task in demographic analysis. It can be more complex than it seems, particularly at municipal level where city borders can change quite frequently.\n\nFortunately, R has a series of packages that can help navigate these challenges. This post details how I approach boundary changes in population analysis, using [`tidycensus`](https://walker-data.com/tidycensus/index.html), [`sf`](https://r-spatial.github.io/sf/) and [`tigris`](https://github.com/walkerke/tigris) analyzing Kokomo, Indiana as an example.\n\n::: {.callout-note collapse=\"true\"}\nThe analysis in this post uses the `tidycensus` R package heavily. To learn more about how to set up and use that package, check out my blog post on it [here](https://aaroneolson.me/posts/2024-11-22-tidycensus-guide/). To view the code behind the analysis, click the dropdowns throughout the post.\n:::\n\n## Kokomo's Population Growth\n\nAccording to the most recent decennial Census, Kokomo, Indiana's population grew from around 45K in 2010 to over 59K in 2020. That seems significant and worth investigating, especially for a small city whose population had hovered between 44K and 47K [since the 1960's](https://en.wikipedia.org/wiki/Kokomo,_Indiana#Demographics).\n\nLet's turn to tidycensus.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Load packages and set up API key\"}\nlibrary(\"tidycensus\")\nlibrary(\"tidyverse\")\nlibrary('hrbrthemes') # to make the plots pretty :)\nlibrary(\"sf\")\nlibrary(\"tigris\")\n\ncensus_api_key(Sys.getenv(\"TIDYCENSUS_KEY\"), install = TRUE, overwrite = TRUE)\n```\n:::\n\n\n@fig-kokomo-2000-2010 shows the significant increase in the city's population between 2010 and 2020. The most logical follow-up is to see whether there is a jump in any particular year, or if the change was more gradual.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Make a plot of Kokomo's population\"}\n# Get population of Kokomo, Indiana in 2000 using get_decennial\npop_2000 <- get_decennial(geography = \"place\", \n                          variables = \"PCT012001\", \n                          state = \"IN\", \n                          year = 2000) %>%\n  filter(\n    NAME == 'Kokomo city, Indiana'\n  )\n\n# Get population of Kokomo, Indiana in 2010 using get_decennial\npop_2010 <- get_decennial(geography = \"place\", \n                          variables = \"P001001\", \n                          state = \"IN\", \n                          year = 2010)  %>%\n  filter(\n    NAME == 'Kokomo city, Indiana'\n  )\n\n\n# Get population of Kokomo, Indiana in 2020 using get_decennial\npop_2020 <- get_decennial(geography = \"place\", \n                          variables = \"P1_001N\", \n                          state = \"IN\", \n                          year = 2020) %>%\n  filter(\n    NAME == 'Kokomo city, Indiana'\n  )\n\n\n# Combine the three data frames into one\nkokomo_pop_data <- bind_rows(pop_2000, pop_2010, pop_2020)\n\n# add a column for the year\nkokomo_pop_data$year <- c(2000, 2010, 2020)\n\n\n# Plot the population of Kokomo over time in a bar chart \nggplot(kokomo_pop_data, aes(x = year, y = value)) +\n  geom_bar(stat = \"identity\", fill = 'dodgerblue') +\n  labs(title = \"Population of Kokomo, Indiana\",\n       subtitle = \"2000, 2010, and 2020 Decennial Census\",\n       x = \"Year\",\n       y = \"Population\") +\n  theme_ipsum() +\n  theme(axis.text.x = element_text(hjust = 1)) +\n  scale_y_continuous(labels = scales::comma, limits = c(0, 62000)) +\n  geom_text(aes(label = scales::comma(value), y = value), vjust = -0.5)\n```\n\n::: {.cell-output-display}\n![Population of Kokomo, Indiana, 2000-2020. Decennial Census.](index_files/figure-html/fig-kokomo-2000-2010-1.png){#fig-kokomo-2000-2010 width=672}\n:::\n:::\n\n\nThe year-over-year change in population is shown in @fig-kokomo-2010-2020. No doubt about it, 2012 is an outlier. The population increased by over 8,000 people in one year, compared to less than 1,300 in every other observation in this data set.\n\n::: {.callout-note collapse=\"true\"}\nACS population estimates (particular the 5-Year sample) like the ones below aren't the most precise population estimates put out by the Census Bureau, they work well enough to show general trends. The 1-Year sample is not available for Kokomo, as it only covers geographies with a population of 65,000 or greater.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Make a plot of Kokomo's population change over time\"}\n# get annual population estimates for Kokomo\nyears <- c(2010:2022)\nnames(years) <- years\n\nkokomo_by_year <- map_dfr(years, ~{\n  get_acs(\n    geography = \"place\",\n    variables = \"B01001_001\",\n    state = \"IN\",\n    survey = \"acs5\",\n    year = .x\n  )\n}, .id = \"year\") %>%\n  filter(\n    NAME == 'Kokomo city, Indiana'\n  )\n\n# calculate year over year change in population as a new column\nkokomo_by_year <- kokomo_by_year %>%\n  mutate(\n    pop_change = estimate - lag(estimate),\n    pop_change_pct = (estimate - lag(estimate)) / lag(estimate) * 100\n  )\n\n\n# plot a line chart of the pop_change\nggplot(kokomo_by_year, aes(x = year, y = pop_change, group = 1)) +\n  geom_line(color = 'dodgerblue') +\n  geom_point(color = 'dodgerblue') +\n  labs(title = \"Year over Year Population Change\",\n       subtitle = \"Kokomo, Indiana\",\n       x = \"Year\",\n       y = \"Population Change\") +\n  theme_ipsum() +\n  scale_y_continuous(labels = scales::comma, limits = c(-300, 9000)) +\n  geom_text(aes(label = scales::comma(pop_change), y = pop_change), vjust = -0.5) +\n  scale_x_discrete(breaks = seq(2010, 2022, 2))\n```\n\n::: {.cell-output-display}\n![Annual Population Change in Kokomo, Indiana, 2010-2020. ACS.](index_files/figure-html/fig-kokomo-2010-2020-1.png){#fig-kokomo-2010-2020 width=672}\n:::\n:::\n\n\n## Investigating City Limit Changes\n\nBased on the data so far, it appears Kokomo's boundaries may have changed around 2012, resulting in annexation of new land and a population increase. To confirm this, I used the `tigris` package to map the city's boundaries over time. The map below shows Kokomo's city limits each year from 2014 through 2020 layered on top of one another.\n\nWhen I attempted to include years before 2014, the `tigris` package told me that the boundaries were not available for those years. I will address that by importing shapefiles downloaded from the Census website for those specific years later in the post.\n\n::: {.callout-note collapse=\"true\"}\nThere are certainly more elegant ways to write the code below, but in the spirit of the [\"Make it Work. Make it Right. Make it Fast.\"](https://medium.com/swlh/coding-faster-make-it-work-then-make-it-good-6aa988ebd8ab) mantra, this code sits firmly in the \"Make it Work\" bucket.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Get Kokomo city borders from 2014 through 2020\"}\n# get kokomo boundaries in 2020\nkokomo_2020 <- places(cb = TRUE, year = 2020) %>%\n  filter(str_detect(NAMELSAD, \"Kokomo city\"))\n\n# write a loop to get kokomo boundaries for each year from 2013 to 2020\nkokomo_boundaries <- map_dfr(2014:2020, ~{\n  places(state = \"IN\", cb = TRUE, year = .x)\n}, .id = \"year\") %>%\n  filter(str_detect(NAME, \"Kokomo\"))\n\n# Add the correct 'year' column \nkokomo_boundaries <- kokomo_boundaries %>% mutate(year = rep(2014:2020, each = nrow(kokomo_boundaries) / 7))\n\n# kokomo census tracts in 2020\nkokomo_2020_tracts <- tracts(state = \"IN\", county = \"Howard\", year = 2020)\n\n# split the kokomo_boundaries file into dataframes of each year of the data\nkokomo_boundaries_2019 <- kokomo_boundaries %>%\n  filter(year == 2019)\nkokomo_boundaries_2018 <- kokomo_boundaries %>%\n  filter(year == 2018)\nkokomo_boundaries_2017 <- kokomo_boundaries %>%\n  filter(year == 2017)\nkokomo_boundaries_2016 <- kokomo_boundaries %>%\n  filter(year == 2016)\nkokomo_boundaries_2015 <- kokomo_boundaries %>%\n  filter(year == 2015)\nkokomo_boundaries_2014 <- kokomo_boundaries %>%\n  filter(year == 2014)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Make a plot of Kokomo city limits from 2014 through 2020\"}\n# plot the city limits\n# add a background map\nkokomo_lims <- ggplot() + \n  geom_sf(data = kokomo_2020_tracts, fill = NA, color = \"grey\") +\n  geom_sf(data = kokomo_2020, fill = NA, color = \"red\") + \n  geom_sf(data = kokomo_boundaries_2019, fill = NA, color = \"blue\") +\n  geom_sf(data = kokomo_boundaries_2018, fill = NA, color = \"green\") +\n  geom_sf(data = kokomo_boundaries_2017, fill = NA, color = \"purple\") +\n  geom_sf(data = kokomo_boundaries_2016, fill = NA, color = \"orange\") +\n  geom_sf(data = kokomo_boundaries_2015, fill = NA, color = \"brown\") +\n  geom_sf(data = kokomo_boundaries_2014, fill = NA, color = \"black\") +\n  # geom_sf(data = kokomo_boundaries, aes(fill = year), color = \"black\") +\n  theme_void()\n\n# add a title to the map\n# add a legend showing that the 2014 boundaries are in black and the 2015-2020 boundaries are in red\nkokomo_lims + labs(title = \"  Kokomo City Limits 2014-2020\", \n                   subtitle = '  2014 boundaries in black; 2015-2020 in red',\n                   caption = 'Howard County Census tracts in grey ')\n```\n\n::: {.cell-output-display}\n![Kokomo's city limits each year](index_files/figure-html/fig-kokomo-city-limits-2014-2020-1.png){#fig-kokomo-city-limits-2014-2020 width=672}\n:::\n:::\n\n\nThe boundaries for 2014 are show in black, and the boundaries for years 2015-2020 are showing in red. You can clearly see that between 2014 and 2015, the city expanded to the east and south. However, this expansion doesn't appear to have pulled in a significant population addition.\n\n## Bringing in Shapefiles for Earlier Years\n\nNext, I imported shapefiles for Kokomo's city limits for years before 2014. These files were downloaded from the Census Bureau [TIGER Shapefiles website](https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html). I used the `sf` package to read in the shapefiles and plot them with the previously shown boundaries.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Read in shapefiles for Kokomo's city limits for years before 2014\"}\n# read in shapefiles for Kokomo's city limits for years before 2014\n\n# 2013\nkokomo_boundaries_2013 <- st_read(\"tl_2013_18_place//tl_2013_18_place.shp\")\n\nkokomo_boundaries_2013 <- kokomo_boundaries_2013 %>%\n  filter(str_detect(NAME, \"Kokomo\"))\n\n# 2012\nkokomo_boundaries_2012 <- st_read(\"tl_2012_18_place//tl_2012_18_place.shp\")\n\nkokomo_boundaries_2012 <- kokomo_boundaries_2012 %>%\n  filter(str_detect(NAME, \"Kokomo\"))\n\n# 2011\nkokomo_boundaries_2011 <- st_read(\"tl_2011_18_place//tl_2011_18_place.shp\")\n\nkokomo_boundaries_2011 <- kokomo_boundaries_2011 %>%\n  filter(str_detect(NAME, \"Kokomo\"))\n\n# 2010\nkokomo_boundaries_2010 <- st_read(\"tl_2010_18_place10//tl_2010_18_place10.shp\")\n\nkokomo_boundaries_2010 <- kokomo_boundaries_2010 %>%\n  filter(str_detect(NAME10, \"Kokomo\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Plot the city limits each year, 2010-2020\"}\n# plot the city limits\n# add a background map\nkokomo_lims <- ggplot() + \n  geom_sf(data = kokomo_2020_tracts, fill = NA, color = \"grey\") +\n  geom_sf(data = kokomo_2020, fill = NA, color = \"red\") + \n  geom_sf(data = kokomo_boundaries_2019, fill = NA, color = \"blue\") +\n  geom_sf(data = kokomo_boundaries_2018, fill = NA, color = \"green\") +\n  geom_sf(data = kokomo_boundaries_2017, fill = NA, color = \"purple\") +\n  geom_sf(data = kokomo_boundaries_2016, fill = NA, color = \"orange\") +\n  geom_sf(data = kokomo_boundaries_2015, fill = NA, color = \"brown\") +\n  geom_sf(data = kokomo_boundaries_2014, fill = NA, color = \"black\") +\n  geom_sf(data = kokomo_boundaries_2013, fill = NA, color = \"darkgreen\") +\n  geom_sf(data = kokomo_boundaries_2012, fill = NA, color = \"black\") +\n  geom_sf(data = kokomo_boundaries_2011, fill = NA, color = \"dodgerblue2\") +\n  geom_sf(data = kokomo_boundaries_2010, fill = NA, color = \"dodgerblue2\") +\n  theme_void()\n\n# add a title to the map\nkokomo_lims + labs(title = \"  Kokomo City Limits 2010-2020\", \n                   subtitle = '  2010-2011 boundaries in blue\n  2012-2014 boundaries in black \n  2015-2020 in red',\n                   caption = 'Howard County Census tracts in grey ')\n```\n\n::: {.cell-output-display}\n![Kokomo's city limits each year, 2010-2020](index_files/figure-html/fig-kokomo-city-limits-2010-2020-1.png){#fig-kokomo-city-limits-2010-2020 width=672}\n:::\n:::\n\n\nBingo!\n\nJust as the line chart of year-over-year population change showed, the city limits expanded significantly between 2011 and 2012, then expanded even further in 2015.\n\nThat increase of over 8,000 people in one year was likely due to annexation of new land, not a sudden population boom. As a double-check, some [local news articles](https://www.wthr.com/article/news/local/judge-okays-kokomo-annexation/531-dc4f6603-bc78-4b59-b0c4-7ad48bf5fb9c) from the time confirm my initial suspicion.\n\n## Conclusion\n\nSo, what's the solution? There are more advanced techniques that attempt to hold the geographic boundaries steady over time, but that's outside the scope of this post. Additionally, you could lean on the Census Bureau's [population estimates program](https://www.census.gov/programs-surveys/popest.html) for more granular population change data.\n\nA good alternative is to use either counties or county subdivisions (townships) to approximate the same area over time. Center Township in Howard County contains most of Kokomo. Here is the population over time for Center Township. Notice how stable it is.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Get population of Center Township, Howard County, Indiana\"}\n# get annual population estimates for Center Township\nyears <- c(2010:2023)\nnames(years) <- years\n\ncenter_by_year <- map_dfr(years, ~{\n  get_acs(\n    geography = \"county subdivision\",\n    variables = \"B01001_001\",\n    state = \"IN\",\n    survey = \"acs5\",\n    year = .x\n  )\n}, .id = \"year\") %>%\n  filter(\n    NAME == 'Center township, Howard County, Indiana'\n  )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Plot Center Township's population\"}\n# plot a line chart of center township\nggplot(center_by_year, aes(x = year, y = estimate, group = 1)) +\n  geom_line(color = 'dodgerblue') +\n  geom_point(color = 'dodgerblue') +\n  labs(title = \"Center Township, Howard County\",\n       subtitle = \"Population over time\",\n       x = \"Year\",\n       y = \"Population\") +\n  theme_ipsum() +\n  scale_y_continuous(labels = scales::comma, limits = c(0, 60000)) +\n  scale_x_discrete(breaks = seq(2010, 2023, 2))\n```\n\n::: {.cell-output-display}\n![Center Township's population, 2010-2023](index_files/figure-html/fig-center-township-2010-2023-1.png){#fig-center-township-2010-2023 width=672}\n:::\n:::\n\n\nCity boundaries change frequently. When looking at population change--or any metric that uses population as a denominator--it's import to keep the possibility of annexation in mind.\n\nThe `tidycensus`, `sf`, and `tigris` packages are a powerful toolkit for ensuring the results of your analysis can be placed in the proper context.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}